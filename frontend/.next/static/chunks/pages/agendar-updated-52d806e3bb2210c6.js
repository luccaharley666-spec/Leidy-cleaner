(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[300],{7909:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/agendar-updated",function(){return t(711)}])},711:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return Agendar}});var l=t(5893),n=t(7294),s=t(8165),o=t(3120),Scheduling_CalendarPicker=e=>{let{onDateSelected:a,unavailableDates:t=[]}=e,[s,o]=(0,n.useState)(new Date),[r,i]=(0,n.useState)(null),getDaysInMonth=e=>new Date(e.getFullYear(),e.getMonth()+1,0).getDate(),getFirstDayOfMonth=e=>new Date(e.getFullYear(),e.getMonth(),1).getDay(),isDateUnavailable=e=>t.some(a=>new Date(a).toDateString()===e.toDateString()),handleDateClick=e=>{let t=new Date(s.getFullYear(),s.getMonth(),e);!isDateUnavailable(t)&&t>=new Date&&(i(t),a(t))};return(0,l.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow-md",children:[(0,l.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Selecione a Data"}),(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("button",{onClick:()=>o(new Date(s.getFullYear(),s.getMonth()-1)),className:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300",children:"←"}),(0,l.jsx)("span",{className:"font-bold",children:s.toLocaleDateString("pt-BR",{month:"long",year:"numeric"})}),(0,l.jsx)("button",{onClick:()=>o(new Date(s.getFullYear(),s.getMonth()+1)),className:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300",children:"→"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-7 gap-2",children:[["Dom","Seg","Ter","Qua","Qui","Sex","Sab"].map(e=>(0,l.jsx)("div",{className:"text-center font-bold text-gray-600",children:e},e)),(()=>{let e=getDaysInMonth(s),a=getFirstDayOfMonth(s),t=[];for(let e=0;e<a;e++)t.push((0,l.jsx)("div",{className:"p-2"},"empty-".concat(e)));for(let a=1;a<=e;a++){let e=new Date(s.getFullYear(),s.getMonth(),a),n=isDateUnavailable(e),o=(null==r?void 0:r.toDateString())===e.toDateString(),i=e<new Date;t.push((0,l.jsx)("button",{onClick:()=>handleDateClick(a),disabled:n||i,className:"p-2 rounded text-center font-semibold ".concat(o?"bg-blue-600 text-white":n||i?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-white border border-gray-300 hover:bg-blue-100"),children:a},a))}return t})()]}),r&&(0,l.jsx)("div",{className:"mt-4 p-3 bg-blue-50 rounded",children:(0,l.jsxs)("p",{className:"text-sm font-semibold text-blue-800",children:["Data selecionada: ",r.toLocaleDateString("pt-BR")]})})]})},Scheduling_ServiceSelector=e=>{let{onServiceSelected:a,services:t=[]}=e,[s,o]=(0,n.useState)([]),r=t.length>0?t:[{id:1,name:"Limpeza Padr\xe3o",price:80,icon:"\uD83E\uDDF9"},{id:2,name:"Limpeza Profunda",price:120,icon:"✨"},{id:3,name:"Mudan\xe7a (In/Out)",price:150,icon:"\uD83D\uDCE6"},{id:4,name:"Limpeza de Vidros",price:30,icon:"\uD83E\uDE9F"},{id:5,name:"Limpeza de Refrigerador",price:25,icon:"❄️"},{id:6,name:"Limpeza de Forno",price:40,icon:"\uD83D\uDD25"}],handleServiceToggle=e=>{let t=s.some(a=>a.id===e.id)?s.filter(a=>a.id!==e.id):[...s,e];o(t),a(t)};return(0,l.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow-md",children:[(0,l.jsx)("h3",{className:"text-xl font-bold mb-6",children:"Selecione os Servi\xe7os"}),(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:r.map(e=>(0,l.jsx)("button",{onClick:()=>handleServiceToggle(e),className:"p-4 rounded-lg border-2 transition text-left ".concat(s.some(a=>a.id===e.id)?"border-blue-600 bg-blue-50":"border-gray-300 bg-white hover:border-blue-300"),children:(0,l.jsxs)("div",{className:"flex justify-between items-start",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("p",{className:"font-bold text-lg",children:[e.icon," ",e.name]}),(0,l.jsxs)("p",{className:"text-gray-600 text-sm mt-1",children:["R$ ",e.price.toFixed(2)]})]}),(0,l.jsx)("div",{className:"w-6 h-6 rounded-full border-2 flex items-center justify-center ".concat(s.some(a=>a.id===e.id)?"bg-blue-600 border-blue-600":"border-gray-300"),children:s.some(a=>a.id===e.id)&&(0,l.jsx)("span",{className:"text-white text-sm",children:"✓"})})]})},e.id))}),s.length>0&&(0,l.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 rounded",children:[(0,l.jsx)("p",{className:"font-semibold text-blue-900",children:"Servi\xe7os selecionados:"}),(0,l.jsx)("ul",{className:"mt-2 space-y-1",children:s.map(e=>(0,l.jsxs)("li",{className:"text-blue-800 text-sm",children:["• ",e.name," - R$ ",e.price.toFixed(2)]},e.id))})]})]})},r=t(3454);function Agendar(){let[e,a]=(0,n.useState)(1),[t,i]=(0,n.useState)(null),[d,c]=(0,n.useState)([]),[u,x]=(0,n.useState)(""),[m,g]=(0,n.useState)(""),[b,h]=(0,n.useState)(""),[p,j]=(0,n.useState)([]),[f,v]=(0,n.useState)(null),[N,y]=(0,n.useState)(""),[w,D]=(0,n.useState)(!1),handleSubmit=async()=>{try{var e,l;if(D(!0),!t||!d.length||!u||!b){alert("⚠️ Por favor, preencha todos os campos obrigat\xf3rios"),D(!1);return}let n={userId:1,serviceId:(null===(e=d[0])||void 0===e?void 0:e.id)||1,date:t,time:"10:00",address:u,phone:b,price:calculateTotal(),notes:N},s=localStorage.getItem("token")||"demo-token",o=r.env.NEXT_PUBLIC_API_URL||"http://localhost:3001",m=await fetch("".concat(o,"/api/bookings"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify(n)});if(!m.ok){let e=await m.json();throw Error(e.error||"Falha ao agendar")}let p=await m.json();console.log("✅ Agendamento criado:",p),alert("✅ Agendamento realizado com sucesso!\nID: ".concat((null===(l=p.booking)||void 0===l?void 0:l.id)||"N/A")),i(null),c([]),x(""),h(""),g(""),y(""),a(1)}catch(e){console.error("❌ Erro ao processar agendamento:",e),alert("❌ Erro: ".concat(e.message||"Falha ao agendar. Tente novamente."))}finally{D(!1)}},calculateTotal=()=>d.reduce((e,a)=>e+(a.price||0),0);return(0,l.jsxs)("div",{className:"flex flex-col min-h-screen",children:[(0,l.jsx)(s.Z,{}),(0,l.jsxs)("main",{className:"flex-grow max-w-4xl mx-auto w-full px-4 py-8",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"Agendar Servi\xe7o de Limpeza"}),(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsx)("div",{className:"flex justify-between items-center mb-4",children:[1,2,3,4].map(a=>(0,l.jsx)("div",{className:"flex-1 h-2 mx-1 rounded transition ".concat(a<=e?"bg-blue-600":"bg-gray-300")},a))}),(0,l.jsxs)("p",{className:"text-center text-gray-600 font-semibold",children:["Passo ",e," de 4"]})]}),(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8 mb-8",children:[1===e&&(0,l.jsx)(Scheduling_CalendarPicker,{onDateSelected:i}),2===e&&(0,l.jsx)(Scheduling_ServiceSelector,{onServiceSelected:c}),3===e&&(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-xl font-bold mb-6",children:"Localiza\xe7\xe3o e Detalhes"}),(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block font-semibold mb-2",children:"Telefone *"}),(0,l.jsx)("input",{type:"tel",value:b,onChange:e=>h(e.target.value),placeholder:"(11) 9999-9999",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block font-semibold mb-2",children:"Endere\xe7o Completo *"}),(0,l.jsx)("input",{type:"text",value:u,onChange:e=>x(e.target.value),placeholder:"Rua, n\xfamero, complemento, bairro, cidade",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block font-semibold mb-2",children:"CEP"}),(0,l.jsx)("input",{type:"text",value:m,onChange:e=>g(e.target.value),placeholder:"00000-000",className:"w-48 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block font-semibold mb-2",children:"Notas Adicionais"}),(0,l.jsx)("textarea",{value:N,onChange:e=>y(e.target.value),placeholder:"Informa\xe7\xf5es adicionais sobre o servi\xe7o...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600",rows:"4"})]})]})]}),4===e&&(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-xl font-bold mb-6",children:"Resumo do Agendamento"}),(0,l.jsxs)("div",{className:"bg-gray-50 p-6 rounded-lg space-y-3",children:[(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Data:"})," ",t]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Servi\xe7o:"})," ",d.map(e=>e.name).join(", ")]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Endere\xe7o:"})," ",u]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Telefone:"})," ",b]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Total:"})," R$ ",calculateTotal().toFixed(2)]})]})]})]}),(0,l.jsxs)("div",{className:"flex justify-between gap-4 mb-8",children:[(0,l.jsx)("button",{onClick:()=>{e>1&&a(e-1)},disabled:1===e,className:"px-6 py-3 border border-gray-300 rounded-lg font-semibold disabled:opacity-50",children:"Voltar"}),e<4?(0,l.jsx)("button",{onClick:()=>{e<4&&a(e+1)},className:"px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700",children:"Pr\xf3ximo"}):(0,l.jsx)("button",{onClick:handleSubmit,disabled:w,className:"px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 disabled:opacity-50",children:w?"⏳ Agendando...":"✅ Confirmar Agendamento"})]})]}),(0,l.jsx)(o.Z,{})]})}}},function(e){e.O(0,[664,708,774,888,179],function(){return e(e.s=7909)}),_N_E=e.O()}]);